<UserControl
    x:Class="xpra.ApControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:local="clr-namespace:xpra"
    mc:Ignorable="d"
    d:DesignHeight="300"
    d:DesignWidth="300">
    <Grid IsEnabled="{Binding IsWorking, Converter={local:NegateBoolConverter}}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
            <RowDefinition />
            <RowDefinition />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ComboBox
                ItemsSource="{Binding ConnectionList}" 
                SelectedItem="{Binding SelectedConnection}"
                DisplayMemberPath="ComboDisplay"
                materialDesign:HintAssist.FloatingScale="0.50"
                Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                SelectionChanged="ComboBox_SelectionChanged"
                FontSize="24">
        </ComboBox>
        <DockPanel Grid.Row="1">
        <TextBlock DockPanel.Dock="Left"
                Text="{Binding SelectedConnection.UrlDisplay}"
                Margin="0,10" />
        <Button Content="Settings"
                DockPanel.Dock="Right"
                Command="{Binding ShowPageCommand}"
                CommandParameter="{x:Static local:Page.Settings}"
                Style="{StaticResource MaterialDesignFlatButton}"
                HorizontalAlignment="Right"/>
        <Button Content="Connect"
                DockPanel.Dock="Right"
                Margin="0,0,10,0"
                Command="{Binding ShowPageCommand}"
                CommandParameter="{x:Static local:Page.Settings}"
                Style="{StaticResource MaterialDesignFlatButton}"
                HorizontalAlignment="Right" />
        </DockPanel>
        <ListBox Grid.Row="2"
                 ItemsSource="{Binding Aps}" HorizontalContentAlignment="Stretch">            
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <StackPanel>
                    <Grid d:DesignWidth="384.268" d:DesignHeight="100.705">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Height="Auto" >
                            <StackPanel.Resources>
                                <Style TargetType="{x:Type TextBlock}">
                                    <Setter Property="Margin" Value="0,10,0,0"/>
                                </Style>
                            </StackPanel.Resources>
                            <TextBlock Text="{Binding Name}" FontSize="30"/>
                            <TextBlock Text="{Binding Path}"/>
                            <TextBlock Text="{Binding Status}"/>
                        </StackPanel>
                            <Button Content="{Binding RunButtonText}"
                                    Grid.Column="1" Height="50"
                                    Background="{Binding RunButtonColor }"
                                    Command="{Binding RelativeSource={RelativeSource AncestorType={x:Type ListBox}},
                                        Path=DataContext.RunApCommand}" 
                                    CommandParameter="{Binding Name}" >
                                <!--<Button.Resources>
                                    <SolidColorBrush x:Key="SecondaryAccentBrush" Color="#F44336"/>
                                    <SolidColorBrush x:Key="SecondaryAccentForegroundBrush" Color="#E57373"/>
                                </Button.Resources>-->

                            </Button>
                        </Grid>
                        <Border Height="2" Margin="0,5,0,0" BorderThickness="0 0 0 1"
                                BorderBrush="{DynamicResource MaterialDesignDivider}"/>
                    </StackPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <StackPanel Grid.Row="3">
            <TextBlock Text="{Binding Message}"
                       Visibility="{Binding IsWorking, Converter={local:BoolToVis}}"   />
            <Grid Height="20">
                <ProgressBar Height="4"
                             Visibility="{Binding IsWorking, Converter={local:BoolToVis}}"                    
                             IsIndeterminate="True"/>
            </Grid>
        </StackPanel>
    </Grid>
</UserControl>
